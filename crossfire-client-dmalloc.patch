--- crossfire-client-1.5.0/configure.in.wiget	Mon Mar 10 14:26:56 2003
+++ crossfire-client-1.5.0/configure.in	Mon Mar 10 14:44:40 2003
@@ -74,6 +74,9 @@
                 use_sdl=no, use_sdl=yes)
 
 
+AC_ARG_ENABLE(dmalloc, [  --enable-dmalloc           Use dmalloc to debug memory allocations [default=yes]],
+		    , enable_dmalloc=yes)
+
 AC_PROG_CC
 
 AC_C_BIGENDIAN
@@ -308,14 +311,17 @@
 
 AC_CHECK_LIB(png, main, , [AC_MSG_ERROR([You must have the png library installed to compile the client])])
 
-dnl not strictly needed, but since the X11 client uses it, lets use it here
-AC_CHECK_LIB(dmalloc, main, DMALLOC_LIB="-ldmalloc")
-
+DMALLOC_LIB=
+if eval "test x$enable_dmalloc = xyes"; then
+	dnl not strictly needed, but since the X11 client uses it, lets use it here
+	AC_CHECK_LIB(dmalloc, main, DMALLOC_LIB="-ldmalloc")
+	AC_CHECK_HEADERS(dmalloc.h)
+fi
 AC_SUBST(DMALLOC_LIB)
 
 dnl Checks for header files.
 AC_HEADER_STDC
-AC_CHECK_HEADERS(fcntl.h sys/ioctl.h sys/time.h unistd.h string.h sys/select.h dmalloc.h)
+AC_CHECK_HEADERS(fcntl.h sys/ioctl.h sys/time.h unistd.h string.h sys/select.h)
 
 dnl Checks for typedefs, structures, and compiler characteristics.
 AC_C_CONST
